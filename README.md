# ✅ Java 언어 수준의 동시성 제어

Java에서는 여러 스레드가 동시에 작업할 때, **공유 자원의 일관성**과 **데이터 정합성**을 유지하기 위해 다양한 **동시성 제어 도구**를 제공합니다. 주요 키워드와 API들을 정리합니다.

---

## 1. `synchronized` 키워드

### 🔹 개념
- 메서드나 블록에 사용되어 **하나의 스레드만 접근 가능**하도록 함
- 내부적으로 **monitor lock (모니터 락)** 을 사용
- 임계 영역(Critical Section)을 보호하여 **데이터 불일치나 레이스 컨디션 방지**

### 🔹 사용 방법
```java
synchronized (lockObject) {
    // 임계 영역
}
```
또는
```java
public synchronized void method() {
    // 동기화된 메서드
}
```

### 🔹 특징
- 객체 단위로 락이 걸림 (static 메서드의 경우 클래스 단위)
- 자바가 제공하는 가장 기본적인 동시성 제어 방식

### 🔹 사용 시점
- 여러 스레드가 **동일한 자원**을 접근하거나 수정할 때
- **데이터 무결성**을 보장해야 할 때

---

## 2. `volatile` 키워드

### 🔹 개념
- **변수의 값을 모든 스레드에 즉시 반영**
- 스레드가 변수 값을 CPU 캐시가 아닌 **메인 메모리에서 읽고 씀**

### 🔹 특징
- 값을 읽고 쓰는 것은 보장하지만, **동기화나 원자성은 보장하지 않음**
- 읽기/쓰기 자체는 동기화보다 빠름

### 🔹 사용 시점
- 변수 값이 여러 스레드에 의해 자주 읽히고 **변경은 한 스레드에 의해 수행**될 때
- **플래그 변수**처럼 동기화는 필요 없지만, 즉시 반영이 필요할 때

---

## 3. java.util.concurrent 패키지 (J.U.C)

Java 5부터 도입된 고급 동시성 API로, 보다 정교한 동기화 제어와 **비동기 처리**, **스레드 관리** 기능을 제공.

### 3.1 `ReentrantLock`
- synchronized와 유사한 **Lock 인터페이스 구현체**
- 명시적으로 `lock()` / `unlock()` 제어 가능
- `tryLock()` / `lockInterruptibly()` 등 유연한 제어 가능
- 공정성(Fairness) 설정 가능

```java
Lock lock = new ReentrantLock();
lock.lock();
try {
    // 임계 영역
} finally {
    lock.unlock();
}
```

### 3.2 `ReadWriteLock`
- 읽기 작업은 동시에, 쓰기 작업은 단독 수행 가능
- 읽기 작업이 많은 경우 성능에 유리

### 3.3 `CountDownLatch`
- 설정한 개수만큼 `countDown()` 되면 대기 중인 스레드가 진행
- 여러 스레드의 작업 완료를 기다려서 **동기화 지점**을 만들고 싶을 때

### 3.4 `CyclicBarrier`
- 지정된 수의 스레드가 모두 `await()` 호출 시까지 대기 후 동시에 실행
- N개의 스레드가 **동시에 다음 단계**로 넘어가야 할 때

### 3.5 `Semaphore`
- **동시에 접근 가능한 스레드 수 제한**
- 제한된 리소스(DB 커넥션 등) 접근 제어

### 3.6 `ExecutorService` / `Future` / `Callable`
- 스레드 풀 기반 작업 실행
- `submit()`을 통해 Callable 작업 제출 → Future로 비동기 결과 수신

### 3.7 `ConcurrentHashMap`
- 멀티스레드 환경에서도 **Thread-safe**한 해시맵
- 내부적으로 세그먼트 분할 또는 CAS 사용

---

## ✅ 요약 비교

| 도구 | 목적 | 특징 | 사용 시점 |
|------|------|------|------------|
| `synchronized` | 임계 영역 보호 | 간단, 객체 단위 락 | 기본 동기화 |
| `volatile` | 메모리 동기화 | 캐시 무시, 빠름 | 상태 플래그 등 |
| `ReentrantLock` | 명시적 락 | 유연한 제어 | 복잡한 락 제어 |
| `CountDownLatch` | 스레드 완료 대기 | 일회성 | 스레드 완료 동기화 |
| `CyclicBarrier` | 동시 진행 제어 | 재사용 가능 | 동시에 시작해야 할 때 |
| `Semaphore` | 리소스 접근 제한 | 허용 수 지정 | 제한된 리소스 제어 |
| `ExecutorService` | 스레드풀 관리 | 비동기 실행 | 작업 큐 처리 |
| `ConcurrentHashMap` | 안전한 Map | 부분 락 or CAS | 데이터 공유 필요 시 |
